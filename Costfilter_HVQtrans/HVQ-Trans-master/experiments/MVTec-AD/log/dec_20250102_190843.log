[2025-01-02 19:08:43,230][   train_val.py][line:  90][    INFO] args: Namespace(config='./config_visa.yaml', evaluate=False, local_rank=None, train_only_four_decoder=False)
[2025-01-02 19:08:43,232][   train_val.py][line:  91][    INFO] config: {'criterion': [{'kwargs': {'weight': 1.0},
                'name': 'FeatureMSELoss',
                'type': 'FeatureMSELoss'}],
 'dataset': {'batch_size': 16,
             'image_reader': {'kwargs': {'color_mode': 'RGB',
                                         'image_dir': '/home/customer/Desktop/ZZ/anomaly/GLAD-main/hdd/Datasets/VisA_pytorch'},
                              'type': 'opencv'},
             'input_size': [224, 224],
             'pixel_mean': [0.485, 0.456, 0.406],
             'pixel_std': [0.229, 0.224, 0.225],
             'test': {'meta_file': '../../data/VISA/test.json'},
             'train': {'hflip': False,
                       'meta_file': '../../data/VISA/train.json',
                       'rebalance': False,
                       'rotate': False,
                       'vflip': False},
             'type': 'custom',
             'workers': 4},
 'evaluator': {'eval_dir': './result_eval_temp',
               'key_metric': 'mean_max_auc',
               'metrics': {'auc': [{'name': 'std'},
                                   {'kwargs': {'avgpool_size': [16, 16]},
                                    'name': 'max'},
                                   {'name': 'pixel'}]},
               'save_dir': 'result_eval_temp',
               'vis_compound': {'max_score': None,
                                'min_score': None,
                                'save_dir': 'checkpoints/HVQ_TR_switch_OT/vis_compound_HVQ_TR_switch_OT/visual_VisA_from0'}},
 'exp_path': '.',
 'frozen_layers': ['backbone'],
 'log_path': './log/',
 'net': [{'frozen': True,
          'kwargs': {'outlayers': [1, 2, 3, 4], 'pretrained': True},
          'name': 'backbone',
          'type': 'models.backbones.efficientnet_b4'},
         {'kwargs': {'outstrides': [16]},
          'name': 'neck',
          'prev': 'backbone',
          'type': 'models.necks.MFCN'},
         {'kwargs': {'activation': 'relu',
                     'dim_feedforward': 1024,
                     'dropout': 0.1,
                     'feature_jitter': {'prob': 1.0, 'scale': 20.0},
                     'hidden_dim': 256,
                     'initializer': {'method': 'xavier_uniform'},
                     'neighbor_mask': {'mask': [True, True, True],
                                       'neighbor_size': [7, 7]},
                     'nhead': 8,
                     'normalize_before': False,
                     'num_decoder_layers': 4,
                     'num_encoder_layers': 4,
                     'pos_embed_type': 'learned',
                     'save_recon': {'save_dir': 'result_recon'}},
          'name': 'reconstruction',
          'prev': 'neck',
          'type': 'models.reconstructions.HVQ_TR_switch_OT'}],
 'port': 11111,
 'random_seed': 1234,
 'save_path': './checkpoints/HVQ_TR_switch_OT_VisA_from0',
 'saver': {'always_save': False,
           'auto_resume': False,
           'load_path': 'checkpoints',
           'log_dir': 'log/',
           'resume_model': '/home/customer/Desktop/ZZ/anomaly/HVQ-Trans-master/experiments/MVTec-AD/checkpoints/HVQ_TR_switch_OT_VisA/ckpt_best.pth.tar',
           'save_dir': 'checkpoints/HVQ_TR_switch_OT_VisA_from0'},
 'trainer': {'clip_max_norm': 0.1,
             'lr_scheduler': {'kwargs': {'gamma': 0.1, 'step_size': 800},
                              'type': 'StepLR'},
             'max_epoch': 1000,
             'optimizer': {'kwargs': {'betas': [0.9, 0.999],
                                      'lr': 0.0001,
                                      'weight_decay': 0.0001},
                           'type': 'AdamW'},
             'print_freq_step': 80,
             'tb_freq_step': 1,
             'val_freq_epoch': 10},
 'version': 'v1.0.0'}
[2025-01-02 19:08:57,013][       utils.py][line: 719][    INFO]  not exist, load from https://github.com/lukemelas/EfficientNet-PyTorch/releases/download/1.0/efficientnet-b4-6ed6700e.pth
[2025-01-02 19:08:58,436][       utils.py][line: 740][    INFO] Loaded ImageNet pretrained efficientnet-b4
[2025-01-02 19:09:05,801][   train_val.py][line: 121][    INFO] layers: ['backbone', 'neck', 'reconstruction']
[2025-01-02 19:09:05,801][   train_val.py][line: 122][    INFO] active layers: ['neck', 'reconstruction']
[2025-01-02 19:09:14,231][custom_dataset.py][line:  41][    INFO] building CustomDataset from: ../../data/VISA/train.json
[2025-01-02 19:09:14,254][custom_dataset.py][line:  41][    INFO] building CustomDataset from: ../../data/VISA/test.json
[2025-01-02 19:09:16,105][   train_val.py][line: 308][    INFO] Epoch: [1/1000]	Iter: [1/542000]	Time 1.84 (1.84)	Data 0.83 (0.83)	Loss 10.32390 (10.32390)	LR 0.00010	
[2025-01-02 19:09:42,581][   train_val.py][line: 308][    INFO] Epoch: [1/1000]	Iter: [81/542000]	Time 0.34 (0.33)	Data 0.00 (0.00)	Loss 9.93496 (10.01758)	LR 0.00010	
[2025-01-02 19:10:11,278][   train_val.py][line: 308][    INFO] Epoch: [1/1000]	Iter: [161/542000]	Time 0.45 (0.36)	Data 0.00 (0.00)	Loss 10.38946 (10.10400)	LR 0.00010	
[2025-01-02 19:10:49,827][   train_val.py][line: 308][    INFO] Epoch: [1/1000]	Iter: [241/542000]	Time 0.46 (0.48)	Data 0.00 (0.00)	Loss 8.93924 (9.92777)	LR 0.00010	
[2025-01-02 19:11:29,015][   train_val.py][line: 308][    INFO] Epoch: [1/1000]	Iter: [321/542000]	Time 0.50 (0.49)	Data 0.00 (0.00)	Loss 10.35208 (9.93669)	LR 0.00010	
[2025-01-02 19:12:08,833][   train_val.py][line: 308][    INFO] Epoch: [1/1000]	Iter: [401/542000]	Time 0.55 (0.50)	Data 0.00 (0.00)	Loss 10.99985 (9.98745)	LR 0.00010	
[2025-01-02 19:12:48,281][   train_val.py][line: 308][    INFO] Epoch: [1/1000]	Iter: [481/542000]	Time 0.52 (0.49)	Data 0.00 (0.00)	Loss 10.19341 (9.90887)	LR 0.00010	
[2025-01-02 19:13:30,477][   train_val.py][line: 308][    INFO] Epoch: [2/1000]	Iter: [561/542000]	Time 0.43 (0.55)	Data 0.00 (0.05)	Loss 9.33495 (9.85346)	LR 0.00010	
[2025-01-02 19:14:09,994][   train_val.py][line: 308][    INFO] Epoch: [2/1000]	Iter: [641/542000]	Time 0.54 (0.49)	Data 0.00 (0.00)	Loss 9.92071 (10.00789)	LR 0.00010	
[2025-01-02 19:14:49,106][   train_val.py][line: 308][    INFO] Epoch: [2/1000]	Iter: [721/542000]	Time 0.49 (0.49)	Data 0.00 (0.00)	Loss 10.85756 (9.90983)	LR 0.00010	
[2025-01-02 19:15:28,790][   train_val.py][line: 308][    INFO] Epoch: [2/1000]	Iter: [801/542000]	Time 0.46 (0.50)	Data 0.00 (0.00)	Loss 9.90030 (9.86910)	LR 0.00010	
[2025-01-02 19:16:09,021][   train_val.py][line: 308][    INFO] Epoch: [2/1000]	Iter: [881/542000]	Time 0.49 (0.50)	Data 0.00 (0.00)	Loss 11.62230 (10.17049)	LR 0.00010	
[2025-01-02 19:16:48,764][   train_val.py][line: 308][    INFO] Epoch: [2/1000]	Iter: [961/542000]	Time 0.49 (0.50)	Data 0.00 (0.00)	Loss 10.61541 (10.02976)	LR 0.00010	
[2025-01-02 19:17:28,108][   train_val.py][line: 308][    INFO] Epoch: [2/1000]	Iter: [1041/542000]	Time 0.49 (0.49)	Data 0.00 (0.00)	Loss 9.21633 (10.08778)	LR 0.00010	
[2025-01-02 19:18:08,258][   train_val.py][line: 308][    INFO] Epoch: [3/1000]	Iter: [1121/542000]	Time 0.52 (0.53)	Data 0.00 (0.03)	Loss 10.22460 (10.25042)	LR 0.00010	
[2025-01-02 19:18:48,173][   train_val.py][line: 308][    INFO] Epoch: [3/1000]	Iter: [1201/542000]	Time 0.48 (0.50)	Data 0.00 (0.00)	Loss 9.27474 (9.82081)	LR 0.00010	
[2025-01-02 19:19:28,022][   train_val.py][line: 308][    INFO] Epoch: [3/1000]	Iter: [1281/542000]	Time 0.47 (0.50)	Data 0.00 (0.00)	Loss 9.74075 (10.04585)	LR 0.00010	
[2025-01-02 19:20:09,516][   train_val.py][line: 308][    INFO] Epoch: [3/1000]	Iter: [1361/542000]	Time 0.56 (0.52)	Data 0.00 (0.00)	Loss 8.87481 (9.94576)	LR 0.00010	
[2025-01-02 19:20:50,594][   train_val.py][line: 308][    INFO] Epoch: [3/1000]	Iter: [1441/542000]	Time 0.53 (0.51)	Data 0.00 (0.00)	Loss 10.18341 (10.09592)	LR 0.00010	
[2025-01-02 19:21:34,306][   train_val.py][line: 308][    INFO] Epoch: [3/1000]	Iter: [1521/542000]	Time 0.48 (0.55)	Data 0.01 (0.00)	Loss 10.89187 (10.03343)	LR 0.00010	
[2025-01-02 19:22:18,787][   train_val.py][line: 308][    INFO] Epoch: [3/1000]	Iter: [1601/542000]	Time 0.58 (0.56)	Data 0.00 (0.00)	Loss 9.21863 (9.93634)	LR 0.00010	
[2025-01-02 19:23:05,431][   train_val.py][line: 308][    INFO] Epoch: [4/1000]	Iter: [1681/542000]	Time 0.62 (0.59)	Data 0.02 (0.02)	Loss 9.39678 (9.93043)	LR 0.00010	
[2025-01-02 19:23:47,747][   train_val.py][line: 308][    INFO] Epoch: [4/1000]	Iter: [1761/542000]	Time 0.54 (0.53)	Data 0.00 (0.00)	Loss 9.27860 (10.00523)	LR 0.00010	
[2025-01-02 19:24:28,757][   train_val.py][line: 308][    INFO] Epoch: [4/1000]	Iter: [1841/542000]	Time 0.53 (0.51)	Data 0.01 (0.00)	Loss 9.26440 (9.94330)	LR 0.00010	
[2025-01-02 19:25:09,376][   train_val.py][line: 308][    INFO] Epoch: [4/1000]	Iter: [1921/542000]	Time 0.49 (0.51)	Data 0.00 (0.00)	Loss 9.16985 (9.96612)	LR 0.00010	
[2025-01-02 19:25:50,330][   train_val.py][line: 308][    INFO] Epoch: [4/1000]	Iter: [2001/542000]	Time 0.53 (0.51)	Data 0.00 (0.00)	Loss 9.97585 (9.97391)	LR 0.00010	
[2025-01-02 19:26:32,946][   train_val.py][line: 308][    INFO] Epoch: [4/1000]	Iter: [2081/542000]	Time 0.53 (0.53)	Data 0.00 (0.00)	Loss 9.21290 (9.95492)	LR 0.00010	
[2025-01-02 19:27:18,396][   train_val.py][line: 308][    INFO] Epoch: [4/1000]	Iter: [2161/542000]	Time 0.69 (0.57)	Data 0.00 (0.00)	Loss 9.64056 (10.04643)	LR 0.00010	
[2025-01-02 19:28:04,508][   train_val.py][line: 308][    INFO] Epoch: [5/1000]	Iter: [2241/542000]	Time 0.31 (0.58)	Data 0.00 (0.02)	Loss 9.53534 (9.85904)	LR 0.00010	
[2025-01-02 19:28:49,546][   train_val.py][line: 308][    INFO] Epoch: [5/1000]	Iter: [2321/542000]	Time 0.52 (0.56)	Data 0.00 (0.00)	Loss 10.98232 (9.84123)	LR 0.00010	
[2025-01-02 19:29:29,924][   train_val.py][line: 308][    INFO] Epoch: [5/1000]	Iter: [2401/542000]	Time 0.51 (0.50)	Data 0.00 (0.00)	Loss 10.43553 (10.00610)	LR 0.00010	
[2025-01-02 19:30:11,469][   train_val.py][line: 308][    INFO] Epoch: [5/1000]	Iter: [2481/542000]	Time 0.56 (0.52)	Data 0.00 (0.00)	Loss 10.03859 (9.94937)	LR 0.00010	
[2025-01-02 19:30:52,832][   train_val.py][line: 308][    INFO] Epoch: [5/1000]	Iter: [2561/542000]	Time 0.54 (0.52)	Data 0.00 (0.00)	Loss 10.46067 (9.99942)	LR 0.00010	
[2025-01-02 19:31:38,900][   train_val.py][line: 308][    INFO] Epoch: [5/1000]	Iter: [2641/542000]	Time 0.76 (0.57)	Data 0.03 (0.00)	Loss 9.25441 (9.94877)	LR 0.00010	
[2025-01-02 19:32:25,534][   train_val.py][line: 308][    INFO] Epoch: [6/1000]	Iter: [2721/542000]	Time 0.66 (0.72)	Data 0.00 (0.11)	Loss 10.93320 (10.17647)	LR 0.00010	
[2025-01-02 19:33:09,986][   train_val.py][line: 308][    INFO] Epoch: [6/1000]	Iter: [2801/542000]	Time 0.46 (0.56)	Data 0.00 (0.00)	Loss 10.14207 (10.05804)	LR 0.00010	
[2025-01-02 19:33:51,720][   train_val.py][line: 308][    INFO] Epoch: [6/1000]	Iter: [2881/542000]	Time 0.48 (0.52)	Data 0.00 (0.00)	Loss 10.60743 (10.03858)	LR 0.00010	
[2025-01-02 19:34:32,716][   train_val.py][line: 308][    INFO] Epoch: [6/1000]	Iter: [2961/542000]	Time 0.50 (0.51)	Data 0.00 (0.00)	Loss 9.49962 (9.90335)	LR 0.00010	
[2025-01-02 19:35:14,809][   train_val.py][line: 308][    INFO] Epoch: [6/1000]	Iter: [3041/542000]	Time 0.49 (0.53)	Data 0.00 (0.00)	Loss 9.47643 (9.97674)	LR 0.00010	
[2025-01-02 19:35:59,664][   train_val.py][line: 308][    INFO] Epoch: [6/1000]	Iter: [3121/542000]	Time 0.62 (0.56)	Data 0.01 (0.00)	Loss 9.73083 (10.03732)	LR 0.00010	
[2025-01-02 19:36:46,876][   train_val.py][line: 308][    INFO] Epoch: [6/1000]	Iter: [3201/542000]	Time 0.54 (0.59)	Data 0.00 (0.00)	Loss 9.50629 (9.97426)	LR 0.00010	
[2025-01-02 19:37:32,011][   train_val.py][line: 308][    INFO] Epoch: [7/1000]	Iter: [3281/542000]	Time 0.57 (0.55)	Data 0.00 (0.04)	Loss 9.14269 (9.94392)	LR 0.00010	
[2025-01-02 19:38:12,375][   train_val.py][line: 308][    INFO] Epoch: [7/1000]	Iter: [3361/542000]	Time 0.49 (0.50)	Data 0.00 (0.00)	Loss 10.07860 (9.89332)	LR 0.00010	
[2025-01-02 19:38:53,574][   train_val.py][line: 308][    INFO] Epoch: [7/1000]	Iter: [3441/542000]	Time 0.35 (0.51)	Data 0.00 (0.00)	Loss 9.59603 (10.01079)	LR 0.00010	
[2025-01-02 19:39:33,976][   train_val.py][line: 308][    INFO] Epoch: [7/1000]	Iter: [3521/542000]	Time 0.53 (0.50)	Data 0.00 (0.00)	Loss 10.72169 (9.92711)	LR 0.00010	
[2025-01-02 19:40:14,950][   train_val.py][line: 308][    INFO] Epoch: [7/1000]	Iter: [3601/542000]	Time 0.48 (0.51)	Data 0.00 (0.00)	Loss 9.86889 (10.10221)	LR 0.00010	
[2025-01-02 19:40:56,335][   train_val.py][line: 308][    INFO] Epoch: [7/1000]	Iter: [3681/542000]	Time 0.59 (0.52)	Data 0.00 (0.00)	Loss 10.39803 (9.98628)	LR 0.00010	
[2025-01-02 19:41:39,202][   train_val.py][line: 308][    INFO] Epoch: [7/1000]	Iter: [3761/542000]	Time 0.49 (0.54)	Data 0.00 (0.00)	Loss 8.98623 (9.94661)	LR 0.00010	
[2025-01-02 19:42:24,343][   train_val.py][line: 308][    INFO] Epoch: [8/1000]	Iter: [3841/542000]	Time 0.61 (0.58)	Data 0.00 (0.02)	Loss 9.98411 (9.77618)	LR 0.00010	
[2025-01-02 19:43:10,000][   train_val.py][line: 308][    INFO] Epoch: [8/1000]	Iter: [3921/542000]	Time 0.87 (0.57)	Data 0.00 (0.00)	Loss 10.63610 (9.95044)	LR 0.00010	
[2025-01-02 19:43:54,154][   train_val.py][line: 308][    INFO] Epoch: [8/1000]	Iter: [4001/542000]	Time 0.71 (0.55)	Data 0.01 (0.00)	Loss 9.10342 (9.84724)	LR 0.00010	
[2025-01-02 19:44:36,238][   train_val.py][line: 308][    INFO] Epoch: [8/1000]	Iter: [4081/542000]	Time 0.44 (0.53)	Data 0.00 (0.00)	Loss 9.10382 (9.99781)	LR 0.00010	
[2025-01-02 19:45:16,808][   train_val.py][line: 308][    INFO] Epoch: [8/1000]	Iter: [4161/542000]	Time 0.46 (0.51)	Data 0.00 (0.00)	Loss 8.95757 (10.00314)	LR 0.00010	
[2025-01-02 19:45:57,641][   train_val.py][line: 308][    INFO] Epoch: [8/1000]	Iter: [4241/542000]	Time 0.48 (0.51)	Data 0.00 (0.00)	Loss 9.95207 (9.99395)	LR 0.00010	
[2025-01-02 19:46:38,599][   train_val.py][line: 308][    INFO] Epoch: [8/1000]	Iter: [4321/542000]	Time 0.55 (0.51)	Data 0.00 (0.00)	Loss 9.02194 (9.98998)	LR 0.00010	
[2025-01-02 19:47:19,696][   train_val.py][line: 308][    INFO] Epoch: [9/1000]	Iter: [4401/542000]	Time 0.55 (0.52)	Data 0.00 (0.01)	Loss 10.18093 (9.86779)	LR 0.00010	
[2025-01-02 19:48:02,261][   train_val.py][line: 308][    INFO] Epoch: [9/1000]	Iter: [4481/542000]	Time 0.53 (0.53)	Data 0.00 (0.00)	Loss 9.48496 (10.10512)	LR 0.00010	
[2025-01-02 19:48:43,710][   train_val.py][line: 308][    INFO] Epoch: [9/1000]	Iter: [4561/542000]	Time 0.49 (0.52)	Data 0.00 (0.00)	Loss 10.89120 (9.81622)	LR 0.00010	
[2025-01-02 19:49:26,574][   train_val.py][line: 308][    INFO] Epoch: [9/1000]	Iter: [4641/542000]	Time 0.59 (0.54)	Data 0.02 (0.00)	Loss 9.78717 (10.01341)	LR 0.00010	
[2025-01-02 19:50:13,437][   train_val.py][line: 308][    INFO] Epoch: [9/1000]	Iter: [4721/542000]	Time 0.69 (0.59)	Data 0.00 (0.00)	Loss 8.98322 (9.92590)	LR 0.00010	
[2025-01-02 19:50:59,756][   train_val.py][line: 308][    INFO] Epoch: [9/1000]	Iter: [4801/542000]	Time 0.59 (0.58)	Data 0.00 (0.00)	Loss 9.23243 (9.98314)	LR 0.00010	
[2025-01-02 19:52:01,719][   train_val.py][line: 369][    INFO] Test: [100/2162]	Time 0.232 (0.204)
[2025-01-02 19:52:25,769][   train_val.py][line: 369][    INFO] Test: [200/2162]	Time 0.190 (0.222)
[2025-01-02 19:52:49,275][   train_val.py][line: 369][    INFO] Test: [300/2162]	Time 0.208 (0.226)
[2025-01-02 19:53:13,960][   train_val.py][line: 369][    INFO] Test: [400/2162]	Time 0.187 (0.232)
[2025-01-02 19:53:37,585][   train_val.py][line: 369][    INFO] Test: [500/2162]	Time 0.175 (0.233)
[2025-01-02 19:54:01,319][   train_val.py][line: 369][    INFO] Test: [600/2162]	Time 0.233 (0.233)
[2025-01-02 19:54:34,787][   train_val.py][line: 369][    INFO] Test: [700/2162]	Time 0.260 (0.248)
[2025-01-02 19:55:00,899][   train_val.py][line: 369][    INFO] Test: [800/2162]	Time 0.208 (0.249)
[2025-01-02 19:55:23,174][   train_val.py][line: 369][    INFO] Test: [900/2162]	Time 0.162 (0.246)
[2025-01-02 19:55:44,245][   train_val.py][line: 369][    INFO] Test: [1000/2162]	Time 0.233 (0.243)
[2025-01-02 19:56:08,005][   train_val.py][line: 369][    INFO] Test: [1100/2162]	Time 0.217 (0.242)
[2025-01-02 19:56:34,943][   train_val.py][line: 369][    INFO] Test: [1200/2162]	Time 0.295 (0.245)
[2025-01-02 19:57:05,477][   train_val.py][line: 369][    INFO] Test: [1300/2162]	Time 0.201 (0.249)
[2025-01-02 19:57:34,614][   train_val.py][line: 369][    INFO] Test: [1400/2162]	Time 0.154 (0.252)
[2025-01-02 19:58:04,682][   train_val.py][line: 369][    INFO] Test: [1500/2162]	Time 0.208 (0.256)
[2025-01-02 19:58:37,141][   train_val.py][line: 369][    INFO] Test: [1600/2162]	Time 0.384 (0.260)
[2025-01-02 19:59:08,875][   train_val.py][line: 369][    INFO] Test: [1700/2162]	Time 0.272 (0.263)
[2025-01-02 19:59:40,915][   train_val.py][line: 369][    INFO] Test: [1800/2162]	Time 0.337 (0.266)
[2025-01-02 20:00:13,567][   train_val.py][line: 369][    INFO] Test: [1900/2162]	Time 0.347 (0.270)
[2025-01-02 20:00:44,488][   train_val.py][line: 369][    INFO] Test: [2000/2162]	Time 0.256 (0.272)
[2025-01-02 20:01:12,902][   train_val.py][line: 369][    INFO] Test: [2100/2162]	Time 0.304 (0.272)
[2025-01-02 20:01:31,263][   train_val.py][line: 390][    INFO] Gathering final results ...
[2025-01-02 20:01:31,264][   train_val.py][line: 392][    INFO]  * Loss 5.82665	total_num=2162
